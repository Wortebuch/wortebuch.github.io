<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Форма с валидацией</title>
		<style>
			.error {
				color: red;
				font-size: 0.9em;
			}
		</style>
	</head>
	<body>
		<form id="subscribeForm" action="/#subscribe" method="post">
			<label for="name">Ваше имя:</label><br />
			<input
				type="text"
				id="name"
				name="name"
				placeholder="Екатерина"
				required
			/>
			<div id="nameError" class="error"></div>
			<br />

			<label for="whatsapp">Whatsapp номер:</label><br />
			<input
				type="text"
				id="whatsapp"
				name="whatsapp"
				placeholder="+7 ("
				required
			/>
			<div id="whatsappError" class="error"></div>
			<br />

			<button type="submit" id="submitButton" disabled>Оставить заявку</button>
		</form>

		<script>
			const nameInput = document.getElementById("name");
			const whatsappInput = document.getElementById("whatsapp");
			const nameError = document.getElementById("nameError");
			const whatsappError = document.getElementById("whatsappError");
			const submitButton = document.getElementById("submitButton");

			// Инициализация маски телефона
			whatsappInput.value = "+7 ";

			whatsappInput.addEventListener("input", function (e) {
				let value = whatsappInput.value.replace(/\D/g, "");

				// Сохраняем +7 в начале
				if (!value.startsWith("7")) {
					value = "7" + value;
				}

				// Обновляем значение поля, позволяя стирать
				const cursorPosition = whatsappInput.selectionStart;
				whatsappInput.value = formatted;

				// Восстанавливаем позицию курсора, чтобы не мешать вводу
				whatsappInput.setSelectionRange(cursorPosition, cursorPosition);

				validateForm();
			});

			// Проверка имени (только русские буквы)
			nameInput.addEventListener("input", function () {
				nameError.textContent = "";
				if (!/^([а-яА-ЯёЁ\s]+)?$/.test(nameInput.value)) {
					nameError.textContent = "Имя должно содержать только русские буквы.";
				}
				validateForm();
			});

			// Удаление сообщения об ошибке при вводе
			whatsappInput.addEventListener("input", function () {
				whatsappError.textContent = "";
				validateForm();
			});

			// Проверка формы для активации кнопки
			function validateForm() {
				const name = nameInput.value.trim();
				const whatsapp = whatsappInput.value.trim();

				let isValid = true;

				// Проверка имени
				if (!name) {
					nameError.textContent = "Пожалуйста, заполните это поле.";
					isValid = false;
				} else if (!/^([а-яА-ЯёЁ\s]+)$/.test(name)) {
					nameError.textContent = "Имя должно содержать только русские буквы.";
					isValid = false;
				}

				// Проверка телефона
				if (!whatsapp || whatsapp.length < 13) {
					whatsappError.textContent = "Введите корректный номер телефона.";
					isValid = false;
				}

				// Управление кнопкой отправки
				submitButton.disabled = !isValid;
			}

			// Инициализация проверки формы
			nameInput.addEventListener("input", validateForm);
			whatsappInput.addEventListener("input", validateForm);
		</script>
	</body>
</html>
